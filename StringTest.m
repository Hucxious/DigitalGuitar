%% 
T = 179.48;         % 张力 (N)
rho = 0.0027646;    % 线密度 (kg/m)
L = 0.65;           % 弦长 (m)
Fs = 44100;         % 采样率
duration = 0.5;     % 持续时间

% 计算并播放声音
[t, y] = SolveWaveEquation(T, rho, L, duration, Fs);

% 应用ADSR包络
y_processed = applyADSR(y, Fs);

% 绘制时域信号
figure;
plot(t, y);
title('弦振动时域信号');
xlabel('时间 (s)');
ylabel('振幅');

% 播放声音
sound(y_processed, Fs);

% 计算波动方程解的相关参数
c = sqrt(T/rho);              % 波速
max_freq = 2000;              % 函数内部指定的最大频率
% dx_initial = c/(2*max_freq);  % 初始空间步长
% Nx = max(3, ceil(L/dx_initial)); % 空间网格点数
% dx = L/(Nx-1);                % 修正后的空间步长
% dt = 1/Fs;                    % 时间步长
% Nt = length(t);               % 实际时间步数

% 命令行输出参数
disp('波动方程解的相关参数：');
disp(['张力 T = ', num2str(T), ' N']);
disp(['线密度 rho = ', num2str(rho), ' kg/m']);
disp(['弦长 L = ', num2str(L), ' m']);
disp(['波速 c = ', num2str(c, '%.2f'), ' m/s']);
% disp(['空间步长 dx = ', num2str(dx, '%.5f'), ' m']);
% disp(['时间步长 dt = ', num2str(dt, '%.6f'), ' s']);
% disp(['空间网格点数 Nx = ', num2str(Nx)]);
% disp(['仿真时间步数 Nt = ', num2str(Nt)]);

% 傅里叶变换分析处理后的信号
Y = fft(y_processed);
N = length(y_processed);
P2 = abs(Y/N);
P1 = P2(1:N/2+1);
P1(2:end-1) = 2*P1(2:end-1);  % 调整幅度
f = Fs*(0:(N/2))/N;           % 构造频率轴

% 绘制频谱图
figure;
plot(f, P1);
title('声音信号的傅里叶频谱');
xlabel('频率 (Hz)');
ylabel('幅度');
xlim([0 max_freq]); % 限制显示频率范围
grid on;

%% 声音频率调参（低音5~高音6）

% 弦长固定为 0.65 米
%      音高      频率(Hz)    张力(N)    线密度(kg/m)
%     _______    ________    _______    ___________
% 
%     {'G3' }        196     179.48      0.0027646 
%     {'G#3'}     207.65     132.48       0.001818 
%     {'A3' }        220     148.71       0.001818 
%     {'A#3'}     233.08     166.92       0.001818 
%     {'B3' }     246.94     187.36       0.001818 
%     {'C4' }     261.63      55.44     0.00047926 
%     {'C#4'}     277.18     62.229     0.00047926 
%     {'D4' }     293.66     69.849     0.00047926 
%     {'D#4'}     311.13     78.403     0.00047926 
%     {'E4' }     329.63     88.005     0.00047926 
%     {'F4' }     349.23     98.782     0.00047926 
%     {'F#4'}     369.99     110.88     0.00047926 
%     {'G4' }        392     124.46     0.00047926 
%     {'G#4'}      415.3      139.7     0.00047926 
%     {'A4' }        440     156.81     0.00047926 
%     {'A#4'}     466.16     176.01     0.00047926 
%     {'B4' }     493.88     197.56     0.00047926 
%     {'C5' }     523.25     71.316     0.00015413 
%     {'C#5'}     554.37     71.082     0.00013686 
%     {'D5' }     587.33     70.874     0.00012157 
%     {'D#5'}     622.25      70.69     0.00010803 
%     {'E5' }     659.26     70.526         0.0001 
%     {'F5' }     698.46     70.382         0.0001 
%     {'F#5'}     739.99     70.253         0.0001 
%     {'G5' }     783.99     70.139         0.0001 
%     {'G#5'}     830.61     70.038         0.0001 
%     {'A5' }        880     69.948         0.0001 

